<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Basics of Red Hat Developer Hub Configuration :: Red Hat Developer Hub Administration</title>
    <link rel="prev" href="index.html">
    <link rel="next" href="git-auth.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Red Hat Developer Hub Administration</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/devhub-admin/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="devhub-admin" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Red Hat Developer Hub Administration</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter1/index.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/install-helm.html">Installing RHDH (Helm Charts)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/install-operator.html">Installing RHDH (Operator)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/upgrade.html">Upgrading RHDH</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/uninstall.html">Uninstalling RHDH</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Basic Configuration</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="basic-config.html">Basic Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="git-auth.html">GitHub Integration and Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="rbac.html">Role Based Access Control</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Red Hat Developer Hub Administration</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Red Hat Developer Hub Administration</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Red Hat Developer Hub Administration</a></li>
    <li><a href="index.html">Basic Configuration</a></li>
    <li><a href="basic-config.html">Basic Configuration</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Basics of Red Hat Developer Hub Configuration</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Recall that RHDH is deployed as an immutable container on OpenShift. Upgrading RHDH to new versions deploys a new container, so the configuration is maintained outside the container as YAML files, which are parsed at container start up and the state persisted to the PostgreSQL database used by RHDH.</p>
</div>
<div class="paragraph">
<p>RHDH uses a number of different YAML files for configuration. Various runtime variables, plugin configuration, and other behaviors can be controlled using these YAML configuration files.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The sections in this chapter assume you have installed RHDH using the operator. If you used a Helm chart for installation, the configuration should more or less work with minimal changes. Consult the product documentation for details.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exploring_the_default_rhdh_configuration"><a class="anchor" href="#_exploring_the_default_rhdh_configuration"></a>Exploring the default RHDH Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let us briefly inspect the OpenShift resources created by the RHDH operator after installation.</p>
</div>
<div class="paragraph">
<p>Log in as the OpenShift cluster administrator user in the web console and switch to the <strong>Developer</strong> perspective.
Click on <code>Topology</code> in the left sidebar, and then expand the hamburger menu (three vertical dots) next to the <code>rhdh</code> Backstage custom resource (CR) to select the <code>Edit Backstage</code> option</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/edit-backstage-cr.png" alt="edit backstage cr">
</div>
<div class="title">Figure 1. Edit Backstage CR</div>
</div>
<div class="paragraph">
<p>In the <code>Backstage details</code> page, click the <code>Resources</code> tab to view the resources created by the operator installation.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/rhdh-op-resources.png" alt="rhdh op resources">
</div>
<div class="title">Figure 2. Resources created by the operator</div>
</div>
<div class="paragraph">
<p>The two <code>ConfigMap</code> resources, <strong>backstage-dynamic-plugins-rhdh</strong> and <strong>backstage-appconfig-rhdh</strong> are used to configure the dynamic plugins, and the overall configuration of RHDH respectively.</p>
</div>
<div class="paragraph">
<p>The <strong>default.app-config.yaml</strong> configuration stored in the <strong>backstage-appconfig-rhdh</strong> ConfigMap is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>data:
  default.app-config.yaml: |
    backend:
      auth:
        keys:
          # This is a default value, which you should change by providing your own app-config
          - secret: "pl4s3Ch4ng3M3"</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This  <strong>default.app-config.yaml</strong> section should not be edited directly to avoid problems during operator upgrades. Instead you must define your own custom <strong>app-config-rhdh.yaml</strong> configuration file as a separate ConfigMap resource, and override the default configuration values.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_configuration_files_app_config_yaml"><a class="anchor" href="#_application_configuration_files_app_config_yaml"></a>Application Configuration Files (app-config-*.yaml)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Recall that an instance of RHDH is called an "App" (short form of <em>Application</em>), and the instance is configured using YAML files. RHDH runs as a container on OpenShift, so this and other configuration files for RHDH should be created as OpenShift <em>ConfigMaps</em> and mounted inside the container.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do NOT hard code sensitive and confidential values in the <strong>app-config.yaml</strong> files! Instead, use environment variable placeholders. You can then store plain text values using <em>ConfigMaps</em> and confidential values like passwords, API keys, encrypted tokens and other sensitive information using <em>Secrets</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The configuration is validated using JSON Schema definitions. You can enable or disable components and plugins, and configure them using these <code>app-config-*.yaml</code> files.
The configuration is shared between the frontend and backend. Values that are common between the two needs to be defined only once, for example, the <code>backend.baseUrl</code>, which defines the root URL of the backend REST API.</p>
</div>
<div class="paragraph">
<p>Configuration is stored in YAML files where the defaults are <strong>app-config.yaml</strong> and <strong>app-config.local.yaml</strong> for locally overriding configuration variables from the default configuration file. Other sets of files can by loaded by passing <code>--config</code> flags.</p>
</div>
<div class="paragraph">
<p>It is possible to have multiple configuration files, to support different environments (Development, QA, Staging, Production, and more), and also to override configuration that is for specific components and plugins. The configuration files to load are selected using a <code>--config</code> flag, and it is possible to load any number of files.</p>
</div>
<div class="paragraph">
<p>If no <code>--config</code> flags are specified, the default behavior is to load <strong>app-config.yaml</strong>. Note that if any <code>--config</code> flags are used, the default <strong>app-config.yaml</strong> file is <strong>NOT</strong> loaded. To include it, you need to explicitly pass it as <code>--config</code> arguments, for example:</p>
</div>
<div class="paragraph">
<p>The RHDH container image uses an entrypoint defined as follows for starting the backend container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>node packages/backend
  --config app-config.yaml \
  --config app-config.example.yaml \
  --config app-config.example.production.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to supply configuration through environment variables, for example, consider the YAML configuration snippet like below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>app:
  baseUrl: https://${HOST}</pre>
</div>
</div>
<div class="paragraph">
<p>You can override the value of <code>baseUrl</code> by passing an environment variable named <strong>APP_CONFIG_app_baseUrl</strong>=https://staging.example.com to the RHDH container.
The environment variable name must be prefixed with <strong>APP_CONFIG</strong> and the nested YAML attributes separated with underscore("_") symbol.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This approach should be used sparingly, usually just for temporary overrides during development.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_file_precedence"><a class="anchor" href="#_configuration_file_precedence"></a>Configuration File Precedence</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Configuration methods have different priority, higher priority methods replace values from configurations with lower priority.
The priority of the configurations is determined by the following rules, in order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configuration from the <strong>APP_CONFIG_</strong> environment variables has the highest priority, followed by files.</p>
</li>
<li>
<p>Files loaded with <code>--config</code> flags are ordered by priority, where the last flag has the highest priority.</p>
</li>
<li>
<p>If no <code>--config</code> flags are provided, <strong>app-config.local.yaml</strong> has higher priority than <strong>app-config.yaml</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_adding_a_custom_app_config_yaml_file"><a class="anchor" href="#_lab_adding_a_custom_app_config_yaml_file"></a>Lab: Adding a Custom app-config YAML File</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is a good practice to override the <strong>default.app-config.yaml</strong> file using your own custom configuration file embedded inside a ConfigMap, and passing it as an argument using <code>--config</code> flags. At runtime, the values from the default configuration are merged with the values from your custom configuration file.</p>
</div>
<div class="paragraph">
<p>To create the custom configuration file, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new ConfigMap named <strong>app-config-rhdh</strong> resource in the same OpenShift project where you installed RHDH (<strong>devhub</strong>).</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click on <code>ConfigMap</code> &#8594; click <code>Create ConfigMap</code></p>
<div class="imageblock">
<div class="content">
<img src="_images/create_config.png" alt="create config">
</div>
<div class="title">Figure 3. ConfigMap</div>
</div>
</li>
<li>
<p>Select <code>YAML</code> view and paste the following YAML snippet.</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">kind: ConfigMap
apiVersion: v1
metadata:
  name: app-config-rhdh
data:
  "app-config-rhdh.yaml": |
    app:
      title: Red Hat Developer Hub
      baseUrl: <strong>https://backstage-rhdh-devhub.apps.cluster-&lt;guid&gt;.dynamic.redhatworkshops.io</strong> <i class="conum" data-value="1"></i><b>(1)</b>
    backend:
      auth:
        keys:
          - secret: <strong>"${BACKEND_SECRET}"</strong> <i class="conum" data-value="2"></i><b>(2)</b>
      baseUrl: <strong>https://backstage-rhdh-devhub.apps.cluster-&lt;guid&gt;.dynamic.redhatworkshops.io</strong> <i class="conum" data-value="1"></i><b>(1)</b>
      cors:
        origin: <strong>https://backstage-rhdh-devhub.apps.cluster-&lt;guid&gt;.dynamic.redhatworkshops.io</strong> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The RHDH URL. Replace <strong>guid</strong> with your unique guid from RHDP</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A secret to define the mandatory RHDH backend authentication key</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Click <code>Create</code> to create the ConfigMap.</p>
</li>
<li>
<p>The custom application configuration file contains a sensitive environment variable, named <strong>BACKEND_SECRET</strong>. This variable contains a mandatory backend authentication key that Developer Hub uses to reference an environment variable defined in an OpenShift Container Platform secret. You must create a secret, named <strong>rhdh-secrets</strong>, and reference it in the Developer Hub CR.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Secrets &gt; Create &#8594; Key/value secret</strong>:</p>
<div class="imageblock">
<div class="content">
<img src="_images/secret.png" alt="secret">
</div>
<div class="title">Figure 4. Create Secret</div>
</div>
</li>
<li>
<p>Enter <strong>rhdh-secrets</strong> in the <code>Secret name</code> field, enter <strong>BACKEND_SECRET</strong> in the <code>Key</code> field. For the <strong>Value</strong> field, open a new command line terminal and generate a base64 encoded string using the following command:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>node -p 'require("crypto").randomBytes(24).toString("base64")'</strong></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Copy the randomly generated string to the <strong>Value</strong> field, and then click <code>Create</code> to create the secret.</p>
<div class="imageblock">
<div class="content">
<img src="_images/random.png" alt="random">
</div>
<div class="title">Figure 5. Create a new secret</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Now that you have created your own custom configuration file with an embedded secret, you need to reference the new custom configuration file in the backstage custom resource (CR) and restart the RHDH container for the changes to take effect. Click on <code>Topology</code> in the left sidebar, and then expand the hamburger menu (three vertical dots) next to the <code>rhdh</code> Backstage custom resource (CR) to select the <code>Edit Backstage</code> option</p>
<div class="imageblock">
<div class="content">
<img src="_images/edit-backstage-cr.png" alt="edit backstage cr">
</div>
<div class="title">Figure 6. Edit Backstage CR</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You will get the <code>Edit Backstage</code> option only if you have installed the Developer Hub using RHDH operator. If you have installed Developer Hub using Helm Charts, you will need to edit Helm Charts.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Reference the <code><strong>app-config-rhdh</strong></code> ConfigMap and the <code><strong>rhdh-secrets</strong></code> secret in the CR:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">apiVersion: rhdh.redhat.com/v1alpha3
kind: Backstage
metadata:
  creationTimestamp: '2025-01-09T11:28:30Z'
  generation: 1
  managedFields:
    - apiVersion: rhdh.redhat.com/v1alpha3
      fieldsType: FieldsV1
      fieldsV1:
        'f:spec':
          .: {}
          'f:application':
            .: {}
            'f:appConfig':
              .: {}
              'f:mountPath': {}
            'f:extraFiles':
              .: {}
              'f:mountPath': {}
            'f:replicas': {}
            'f:route':
              .: {}
              'f:enabled': {}
          'f:database':
            .: {}
            'f:enableLocalDb': {}
      manager: Mozilla
      operation: Update
      time: '2025-01-09T11:28:30Z'
    - apiVersion: rhdh.redhat.com/v1alpha3
      fieldsType: FieldsV1
      fieldsV1:
        'f:status':
          .: {}
          'f:conditions': {}
      manager: manager
      operation: Update
      subresource: status
      time: '2025-01-09T11:28:30Z'
  name: rhdh
  namespace: devhub
  resourceVersion: '57412'
  uid: ed5c1be6-c7c4-4d49-b0b5-67b83a84a878
spec:
  application:
    appConfig:
      mountPath: /opt/app-root/src
      <strong>configMaps:</strong>
         <strong>- name: app-config-rhdh</strong>
    <strong>extraEnvs:</strong>
      <strong>secrets:</strong>
         <strong>- name: rhdh-secrets</strong>
    extraFiles:
      mountPath: /opt/app-root/src
    replicas: 1
    route:
      enabled: true
  database:
    enableLocalDb: true
status:
  conditions:
    - lastTransitionTime: '2025-01-09T11:28:30Z'
      message: ''
      reason: Deployed
      status: 'True'
      type: Deployed</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Click <code>Save</code> to save the changes to the Backstage CR.</p>
</li>
<li>
<p>Switch to the <code>Topology</code> view, and expand the menu next to the <code>backstage-rhdh</code> pod. Click <code>Restart rollout</code> to restart the RHDH pod.</p>
<div class="imageblock">
<div class="content">
<img src="_images/restart-rollout.png" alt="restart rollout">
</div>
<div class="title">Figure 7. Restart RHDH pod to re-read configuration value changes</div>
</div>
<div class="paragraph">
<p>Wait for the RHDH pod to restart (It may take a few minutes). Ensure that the pod is restarted without any errors.</p>
</div>
</li>
<li>
<p>To troubleshoot failed startup, click on the <code>backstage-rhdh</code> pod, and then click the <code>Resources</code> tab. Click <code>View logs</code> to view the pod logs.</p>
<div class="imageblock">
<div class="content">
<img src="_images/logs.png" alt="logs">
</div>
<div class="title">Figure 8. View Pod logs</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Ensure that you correctly indent the CR yaml file when referencing the secret and ConfigMap. Incorrect indentation may cause the pod restart to fail.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Throughout the rest of the course, you will edit the <strong>app-config-rhdh</strong> ConfigMap to configure and enable plugins for RHDH.</p>
</div>
<div class="paragraph">
<p>Whenever you change the configuration in the <code>app-config-rhdh</code> ConfigMap, or create/edit any new secrets, you can force RHDH to re-read the configuration by clicking on the RHDH pod in the <code>Topology</code> page and then selecting <code>Restart rollout</code>.</p>
</div>
<div class="paragraph">
<p>You can also scale down the RHDH pod to zero (0), and then scale it up back to one or more to reload the configuration.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.redhat.com/en/documentation/red_hat_developer_hub/1.2/html-single/getting_started_with_red_hat_developer_hub/index#proc-add-custom-app-config-file-ocp-operator_rhdh-getting-started" target="_blank" rel="noopener">Adding a custom application configuration file to RHDH</a></p>
</li>
<li>
<p><a href="https://backstage.io/docs/conf" target="_blank" rel="noopener">Configuration in Backstage</a></p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Basic Configuration</a></span>
  <span class="next"><a href="git-auth.html">GitHub Integration and Authentication</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
