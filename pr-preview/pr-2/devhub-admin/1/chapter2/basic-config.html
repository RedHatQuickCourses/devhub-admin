<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Basics of Red Hat Developer Hub Configuration :: Red Hat Developer Hub Administration</title>
    <link rel="prev" href="index.html">
    <link rel="next" href="git-auth.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Red Hat Developer Hub Administration</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/devhub-admin/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="devhub-admin" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Red Hat Developer Hub Administration</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter1/index.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/install.html">Installing RHDH</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/upgrade.html">Upgrading RHDH</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/uninstall.html">Uninstalling RHDH</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Basic Configuration</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="basic-config.html">Basic Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="git-auth.html">GitHub Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="rbac.html">Role Based Access Control</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Red Hat Developer Hub Administration</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Red Hat Developer Hub Administration</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Red Hat Developer Hub Administration</a></li>
    <li><a href="index.html">Basic Configuration</a></li>
    <li><a href="basic-config.html">Basic Configuration</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Basics of Red Hat Developer Hub Configuration</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>RHDH uses YAML files for configuration. Various runtime variables, plugin configuration, and other behaviors can be controlled using one or more YAML configuration files.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exploring_the_default_rhdh_configuration"><a class="anchor" href="#_exploring_the_default_rhdh_configuration"></a>Exploring the default RHDH Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let us briefly inspect the OpenShift resources created by the RHDH helm chart after installation.</p>
</div>
<div class="paragraph">
<p>Log in as the OpenShift cluster administrator user in the web console and switch to the <strong>Developer</strong> perspective.
Click on <code>Helm</code> in the left sidebar, and then click the <code>rhdh</code> helm release.</p>
</div>
<div class="paragraph">
<p>Click the <code>Resources</code> tab to view the resources created by the helm chart after installation.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/helm-resources.png" alt="helm resources" width="600">
</div>
<div class="title">Figure 1. Helm Chart Resources</div>
</div>
<div class="paragraph">
<p>The two <code>ConfigMap</code> resources, <strong>dynamic-plugins</strong> and <strong>rhdh-developer-hub-app-config</strong> are used to configure the dynamic plugins, and the overall configuration of RHDH respectively.</p>
</div>
<div class="paragraph">
<p>The default <strong>app-config.yaml</strong> configuration stored in the <strong>rhdh-developer-hub-app-config</strong> ConfigMap is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>app:
  baseUrl: https://rhdh-developer-hub-devhub.apps.cluster-6tkk4.dynamic.redhatworkshops.io
backend:
  auth:
    keys:
    - secret: ${BACKEND_SECRET}
  baseUrl: https://rhdh-developer-hub-devhub.apps.cluster-6tkk4.dynamic.redhatworkshops.io
  cors:
    origin: https://rhdh-developer-hub-devhub.apps.cluster-6tkk4.dynamic.redhatworkshops.io
  database:
    connection:
      password: ${POSTGRESQL_ADMIN_PASSWORD}
      user: postgres</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This default <strong>app-config.yaml</strong> should not be edited directly to avoid problems during helm chart upgrades. Instead you must define your own custom <strong>app-config-rhdh.yaml</strong> configuration file as a separate ConfigMap resource, and override the default configuration values.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_configuration_files_app_config_yaml"><a class="anchor" href="#_application_configuration_files_app_config_yaml"></a>Application Configuration Files (app-config-*.yaml)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Recall that an instance of RHDH is called an "App" (short form of <em>Application</em>), and the instance is configured using YAML files. RHDH runs as a container on OpenShift, so this and other configuration files for RHDH should be created as OpenShift <em>ConfigMaps</em> and mounted inside the container.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do NOT hard code sensitive and confidential values in the <strong>app-config.yaml</strong> files!. Instead, use environment variable placeholders. You can then store plain text values using <em>ConfigMaps</em> and confidential values like passwords, API keys, encrypted tokens and other sensitive information using <em>Secrets</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The configuration is validated using JSON Schema definitions. You can enable or disable components and plugins, and configure them using these <code>app-config-*.yaml</code> files.
The configuration is shared between the frontend and backend. Values that are common between the two needs to be defined only once, for example, the <code>backend.baseUrl</code>, which defines the root URL of the backend REST API.</p>
</div>
<div class="paragraph">
<p>Configuration is stored in YAML files where the defaults are <strong>app-config.yaml</strong> and <strong>app-config.local.yaml</strong> for locally overriding configuration variables from the default configuration file. Other sets of files can by loaded by passing <code>--config</code> flags.</p>
</div>
<div class="paragraph">
<p>It is possible to have multiple configuration files, to support different environments (Development, QA, Staging, Production, and more), and also to override configuration that is for specific components and plugins. The configuration files to load are selected using a <code>--config</code> flag, and it is possible to load any number of files.</p>
</div>
<div class="paragraph">
<p>If no <code>--config</code> flags are specified, the default behavior is to load <strong>app-config.yaml</strong>. Note that if any <code>--config</code> flags are used, the default <strong>app-config.yaml</strong> file is <strong>NOT</strong> loaded. To include it, you need to explicitly pass it as <code>--config</code> arguments, for example:</p>
</div>
<div class="paragraph">
<p>The RHDH container image uses an entrypoint defined as follows for starting the backend container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>node packages/backend
  --config app-config.yaml \
  --config app-config.example.yaml \
  --config app-config.example.production.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to supply configuration through environment variables, for example, consider the YAML configuration snippet like below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>app:
  baseUrl: https://${HOST}</pre>
</div>
</div>
<div class="paragraph">
<p>You can override the value of <code>baseUrl</code> by passing an environment variable named <strong>APP_CONFIG_app_baseUrl</strong>=https://staging.example.com to the RHDH container.
The environment variable name must be prefixed with <strong>APP_CONFIG</strong> and the nested YAML attributes separated with underscore("_") symbol.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This approach should be used sparingly, usually just for temporary overrides during development.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_file_precedence"><a class="anchor" href="#_configuration_file_precedence"></a>Configuration File Precedence</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Configuration methods have different priority, higher priority methods replace values from configurations with lower priority.
The priority of the configurations is determined by the following rules, in order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configuration from the <strong>APP_CONFIG_</strong> environment variables has the highest priority, followed by files.</p>
</li>
<li>
<p>Files loaded with <code>--config</code> flags are ordered by priority, where the last flag has the highest priority.</p>
</li>
<li>
<p>If no <code>--config</code> flags are provided, <strong>app-config.local.yaml</strong> has higher priority than <strong>app-config.yaml</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_adding_a_custom_app_config_yaml_file"><a class="anchor" href="#_lab_adding_a_custom_app_config_yaml_file"></a>Lab: Adding a Custom app-config YAML File</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is a good practice to override the default <strong>app-config.yaml</strong> file using your own custom configuration file embedded inside a ConfigMa, and passing it as an argument using <code>--config</code> flags. At runtime, the values from the default configuration are merged with the values from your custom configuration file.</p>
</div>
<div class="paragraph">
<p>To create the custom configuration file, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new ConfigMap named <strong>app-config-rhdh</strong> resource in the same OpenShift project where you installed RHDH (<strong>devhub</strong>)</p>
<div class="listingblock">
<div class="content">
<pre>kind: ConfigMap
apiVersion: v1
metadata:
  name: app-config-rhdh
data:
  app-config-rhdh.yaml: |
    app:
      title: Red Hat Developer Hub</pre>
</div>
</div>
</li>
<li>
<p>In the <code>Helm Releases</code> page, select the <code>Upgrade</code> option for the <strong>rhdh</strong> helm chart.</p>
</li>
<li>
<p>Expand <code>Root Schema → Backstage Chart Schema → Backstage Parameters → Extra App Configuration files to inline into command arguments</code>, and then click <code>Add Extra app configuration files to inline into command arguments</code>.</p>
</li>
<li>
<p>Add <strong>app-config-rhdh</strong> in the <code>configMapRef</code> field, and <strong>app-config-rhdh.yaml</strong> in the <code>filename</code> field.</p>
</li>
<li>
<p>Click <code>Upgrade</code> to redeploy the RHDH container. It may take a few minutes for the RHDH container to be redeployed with the new configuration.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Throughout the rest of the course, you will edit the <strong>app-config-rhdh</strong> ConfigMap to configure and enable plugins for RHDH.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
One advantage of using helm charts to deploy and manage RHDH is versioned deployments. If for some reason, your configuration causes RHDH to fail deployment, you can rollbacl to  previous releases and recover your old configuration. Correct your configuration file errors and retry the deployment.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rhdh_postgresql_database_configuration"><a class="anchor" href="#_rhdh_postgresql_database_configuration"></a>RHDH PostgreSQL Database Configuration</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section is for informational purposes only. Do not make these changes in your classroom environment because you do not have access to an external PostgreSQL database instance. You will continue to work with the default PostgreSQL database that was installed during RHDH installation for the rest of the course.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For large scale production rollouts, it is recommended to use an external PostgreSQL database instead of the default database provisioned by the RHDH installation process.</p>
</div>
<div class="paragraph">
<p>To integrate your RHDH instance with an external PostgreSQL database instance, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit or create the <strong>app-config-rhdh</strong> ConfigMap if it does not exist (by following the steps outlined in the previous lab), and add the configuration for accessing the external PostgreSQL database. Ensure that the <code>backend</code> attribute is added at the same level as <code>app</code> (that is, below the <code>app-config-rhdh.yaml</code> data element):</p>
<div class="listingblock">
<div class="content">
<pre>app-config-rhdh.yaml: |
    app:
      title: Red Hat Developer Hub
<strong>backend:
  database:
    client: pg
    connection:
      host: mydbhost.example.com
      port: 5432
      user: ${POSTGRES_USER}
      password: ${POSTGRES_PASSWORD}</strong></pre>
</div>
</div>
</li>
<li>
<p>Click <code>Save</code> to save the configuration changes.</p>
</li>
<li>
<p>If you have RHDH already installed, skip this step and jump to the next step. Otherwise, follow the instructions in the <a href="../chapter1/install.html#_install_the_rhdh_helm_chart" class="xref page">Red Hat Developer Hub Installation</a> section to install RHDH using helm charts. In the <code>Create Helm Release</code> page, select <code>YAML View</code> to edit the helm chart values outlined in the next steps.</p>
</li>
<li>
<p>If you have RHDH already installed, in the <code>Helm Releases</code> page, select the <code>Upgrade</code> option for the <strong>rhdh</strong> helm chart.</p>
</li>
<li>
<p>Select <code>YAML View</code> in the <code>Configure via</code> field to view the helm chart values as YAML</p>
</li>
<li>
<p>Search the <code>postgresql.enabled</code> field and set it to <strong>false</strong> to prevent the helm chart from deploying a database.</p>
<div class="listingblock">
<div class="content">
<pre>postgresql:
    auth:
      secretKeys:
        adminPasswordKey: postgres-password
        userPasswordKey: password
    enabled: <strong>false</strong></pre>
</div>
</div>
</li>
<li>
<p>Click <code>Upgrade</code> to redeploy the RHDH instance. It may take some time for the RHDH pods to be redeployed.
Verify that the integration was successful by navigating to the RHDH home page.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_developer_hub/1.0/html-single/getting_started_with_red_hat_developer_hub/index#ref-rhdh-supported-configs_rhdh-getting-started" target="_blank" rel="noopener">Adding a custom application configuration file to RHDH</a></p>
</li>
<li>
<p><a href="https://backstage.io/docs/conf" target="_blank" rel="noopener">Configuration in Backstage</a></p>
</li>
<li>
<p><a href="https://backstage.io/docs/getting-started/configuration#install-and-configure-postgresql" target="_blank" rel="noopener">Configure PostgreSQL database in Backstage</a></p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Basic Configuration</a></span>
  <span class="next"><a href="git-auth.html">GitHub Authentication</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
